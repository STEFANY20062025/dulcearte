<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>DulceArte ‚Äî Personalizar Producto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/image/logo-final.png">
  <link rel="stylesheet" href="/css/style-personalizar.css">
  <link rel="stylesheet" href="/css/carrito.css">
  <link rel="stylesheet" href="/css/form.css">
  <link rel="stylesheet" href="/css/modal-perfil.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
</head>
<body>

  <!-- HEADER -->
  <header>
    <button class="menu-btn" onclick="abrirMenu()"><img src="/image/menu-svgrepo-com.svg" alt="menu" class="menu-icon"></button>
    <div class="logo">DulceArte 
      <img src="/image/logo-final-negro.png" alt="logo" class="header-logo">
    </div>
    <div>
      <a href="/html/productos.html"><img src="/image/shop-svgrepo-com.svg" class="menu-icon"></a>
      <button class="menu-btn" onclick="abrirLogin()" id="botoncin"><img src="/image/user-svgrepo-com.svg" alt="user" class="menu-icon"></button>
      <button class="menu-btn" onclick="abrirCarrito()"><img src="/image/cart-shopping-fast-svgrepo-com.svg" alt="carrito" class="menu-icon"></button>
    </div>
  </header>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>DulceArte</h2>
      <img src="/image/logo-final-negro.png" alt="Logo" class="sidebar-logo">
    </div>

    <a href="/index.html"><img src="/image/home-svgrepo-com.svg" alt="Index" class="icon"> Inicio</a>
    <a href="/html/Factura Electronica.html"><img src="/image/factura.svg" class="icon"> Factura Electr√≥nica</a>
    <a href="#"><img src="/image/contacto.svg" class="icon"> Cont√°ctanos</a>
    <a href="#"><img src="/image/about-svgrepo-com.svg" class="icon"> Qui√©nes somos</a>
    <a href="#"><img src="/image/policy-svgrepo-com.svg" class="icon"> Pol√≠ticas</a>
    <a href="#"><img src="/image/blog-svgrepo-com.svg" class="icon"> Blogs</a>
    <a href="#"><img src="/image/work-svgrepo-com.svg" class="icon"> Trabaja con nosotros</a>

    <h2>Encu√©ntranos en:</h2>
    <div class="social-icons-sidebar">
      <a href="#"><img src="/image/facebook-svgrepo-com.svg" alt="Facebook"></a>
      <a href="#"><img src="/image/instagram-svgrepo-com.svg" alt="Instagram"></a>
      <a href="#"><img src="/image/tiktok-icon-white-1-logo-svgrepo-com.svg" alt="TikTok"></a>
    </div>
  </div>
  <div class="overlay" id="overlay" onclick="cerrarMenu()"></div>

  <!-- CARRITO -->
  <div class="carrito-sidebar" id="carritoSidebar">
    <button class="cerrar-carrito" onclick="cerrarCarrito()">
      <img src="/image/close-ellipse-svgrepo-com.svg" alt="Cerrar">
    </button>
    <h3>Tu Carrito</h3>
    <div id="carrito-items"></div>
    <div class="carrito-footer">
      <div class="carrito-total">
        Total: <span id="carrito-total">$0</span>
      </div>
      <button class="finalizar-compra">Finalizar compra</button>
    </div>
  </div>

    <div class="cfd" id="aparecerr">
        <section class="aparecer">
            <div class="popi" id="popis">
                <div class="sesion">
                    <div class="blanco">
                        <div class="arriba">
                            <h2 class="ses">iniciar sesi√≥n</h2>
                            <div class="redes">
                                <button class="fac"><img src="/image/facebook.svg" alt=""></button>
                                <button class="gool"><img src="/image/google.svg" alt=""></i></button>
                            </div>
                            <a href="#" id="cerrar" class="btncerrar"><img src="/image/close-ellipse-svgrepo-com.svg" alt="close"></a>
                        </div>
                            <div class="gris">
                                <h2 class="nono">¬øno tienes cuenta?</h2>
                                <button id="regi">registrarse</button>
                            </div>
                        <p>o</p>
                        <div class="inic">
                            <input type="email" name="" id="" placeholder="Correo" required>
                            <div class="password-container">
                                <input type="password" id="password-login" placeholder="Contrase√±a" required>
                                <img src="/image/visualizar.svg" alt="mostrar" class="toggle-password" id="see-login">
                            </div>
                            <a href="/html/recuperacion.html" class="olvido-contra" id="olvido">¬øOlvidaste tu contrase√±a?</a>
                            <button class="login">inciar sesi√≥n</button>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    
    <div class="popir" id="aparecers">
        <div class="sesionr" id="popir">
            <h2 class="aaa">¬øya tienes cuenta?</h2>
            <button class="bbb" id="ini">iniciar sesi√≥n</button>
            <a href="#" id="cerrarr" class="btnr"><img src="/image/close-ellipse-svgrepo-com.svg" alt="close"></a>
            <div class="grisr">
                <div class="blancor">
                </div>
                <div class="abajo">
                    <h2>registrarse</h2>
                    <div class="redesr">
                        <button class="facr"><img src="/image/facebook.svg" alt=""></button>
                        <button class="goolr"><img src="/image/google.svg" alt=""></i></button>
                    </div>
                    <p>o</p>
                </div>
                <div class="inpus">
                    <input type="email" name="" id="" placeholder="Correo" required><br>
                    <div class="password-container">
                        <input type="password" id="password-register" placeholder="Contrase√±a" required>
                        <img src="/image/visualizar.svg" alt="mostrar" class="toggle-password" id="see-register">
                    </div>
                </div>
                <button class="reg" id="registrarse">registrarse</button>
            </div>
        </div>
    </div>


  <!-- PERSONALIZADOR -->
  <section class="personalizar-container">
   <div class="vista-producto">
  <img id="postre-base" src="" alt="Imagen del producto">
  <div id="decoraciones-contenedor"></div>
  <div class="lupa" id="lupa"><img id="lupa-img" src=""></div>
</div>


    <div class="configuracion">
      <h2 id="producto-nombre">Cargando...</h2>
      <p id="producto-descripcion">Por favor espera un momento.</p>
      <h3 id="producto-precio">Precio base: ‚Äî</h3>
      <p id="stock">En stock: ‚Äî</p>

      <label for="texto">Texto personalizado:</label>
      <input type="text" id="texto" placeholder="Ej: Feliz Cumplea√±os">

      <h4>Decoraciones disponibles</h4>
      <div class="decoraciones-lista" id="decoraciones-lista">
        <!-- Se cargan con JS -->
      </div>

      <button class="btn-agregar" id="btn-agregar">
        Agregar al pedido 
        <img src="/image/cart-shopping-fast-svgrepo-com.svg" alt="" class="icon-contenedor">
      </button>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-section">
      <h3>Enlaces de inter√©s</h3>
      <ul>
        <li><a href="#">Productos</a></li>
        <li><a href="#">Pol√≠tica de tratamiento de datos</a></li>
        <li><a href="#">Ventas corporativas</a></li>
        <li><a href="#">Facturaci√≥n electr√≥nica</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h3>Nosotros</h3>
      <ul>
        <li><a href="#">Acerca de Venecia</a></li>
        <li><a href="#">Trabaja con nosotros</a></li>
        <li><a href="#">Blogs</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h3>Atenci√≥n al cliente</h3>
      <ul>
        <li><a href="#">Cont√°ctanos</a></li>
        <li>info@nosequenombreponerle.com</li>
      </ul>
    </div>
    <div class="footer-section">
      <h3>Encu√©ntranos en:</h3>
      <div class="social-icons">
        <a href="#"><img src="/image/facebook-svgrepo-com.svg" alt="Facebook"></a>
        <a href="#"><img src="/image/instagram-svgrepo-com.svg" alt="Instagram"></a>
        <a href="#"><img src="/image/tiktok-icon-white-1-logo-svgrepo-com.svg" alt="TikTok"></a>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="/js/nav.js"></script>
  <script src="/js/form.js"></script>
  <script src="/js/carrito.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(window.location.search);
  const productoId = params.get("id");

  const btnAgregar = document.getElementById("btn-agregar");
  const stockTexto = document.getElementById("stock");

  if (!productoId) {
    alert("Producto no especificado.");
    return;
  }

  try {
    const respuesta = await fetch(`http://localhost:5000/producto/${productoId}`);
    const data = await respuesta.json();

    if (data.status !== "ok") {
      alert("No se pudo cargar el producto.");
      return;
    }

    const producto = data.producto;
    const decoraciones = data.decoraciones;

    // üîπ Funci√≥n para formatear precios en COP
    function formatearCOP(valor) {
      const numero = Number(valor);
      if (isNaN(numero)) return "COP 0,00";
      return "COP " + numero.toLocaleString("es-CO", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });
    }

    // üîπ Mostrar datos del producto
    document.getElementById("producto-nombre").textContent = producto.nombre;
    document.getElementById("producto-descripcion").textContent = producto.descripcion;
    document.getElementById("producto-precio").textContent = `Precio base: ${formatearCOP(producto.precio)}`;
    document.getElementById("postre-base").src = producto.imagen;

    // üîπ Mostrar stock y manejar estado de agotado
    if (producto.disponible <= 0) {
      stockTexto.textContent = "Agotado";
      stockTexto.style.color = "red";
      btnAgregar.textContent = "No disponible";
      btnAgregar.disabled = true;
      btnAgregar.classList.add("agotado");
      btnAgregar.style.cursor = "not-allowed";
    } else {
      stockTexto.textContent = `En stock: ${producto.disponible} unidad/es`;
      stockTexto.style.color = "green";
      btnAgregar.disabled = false;
      btnAgregar.classList.remove("agotado");
      btnAgregar.style.cursor = "pointer";
    }

    // üîπ Mostrar decoraciones
    const lista = document.getElementById("decoraciones-lista");
    lista.innerHTML = "";

    decoraciones.forEach((deco) => {
      if (deco.tipo === "objeto") {
        lista.innerHTML += `
          <div class="decoracion-item">
            <img src="${deco.imagen}" alt="${deco.nombre}" class="decoracion-opcion">
            <p>${deco.nombre} - ${formatearCOP(deco.precio)} - ${deco.activo} u.</p>
          </div>`;
      } else if (deco.tipo === "texto") {
        lista.innerHTML += `
          <div class="decoracion-item">
            <button class="decoracion-texto">${deco.nombre}</button>
          </div>`;
      }
    });

  } catch (err) {
    console.error("Error al cargar producto:", err);
    alert("Error de conexi√≥n con el servidor.");
  }
});
</script>


  <script>
const vista = document.querySelector('.vista-producto');
const imagen = document.getElementById('postre-base');

vista.addEventListener('mousemove', (e) => {
  const rect = vista.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width) * 100;
  const y = ((e.clientY - rect.top) / rect.height) * 100;
  imagen.style.transformOrigin = `${x}% ${y}%`;
});

vista.addEventListener('mouseenter', () => {
  vista.classList.add('zoom-activo');
});

vista.addEventListener('mouseleave', () => {
  vista.classList.remove('zoom-activo');
  imagen.style.transformOrigin = 'center center';
});
</script>

<div id="modalPerfil" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModalPerfil()">&times;</span>

    <div class="perfil-info">
      <img src="/image/user-svgrepo-com.svg" alt="Usuario">
      <h2>Perfil de Usuario</h2>
      <p>Actualiza tus datos personales o confirma tu correo electr√≥nico.</p>

      <button class="btn-cerrar-sesion" onclick="cerrarSesion()">
            <img src="/image/keyboard-backspace-svgrepo-com.svg" alt="Salir">
            Cerrar sesi√≥n
        </button>
    </div>

    <form id="formPerfil">
      <label>Correo (no editable)</label>
      <input type="email" id="correo" disabled>
      <small id="estadoCorreo" style="color:gray;">No confirmado</small>


      <button type="button" id="btnConfirmCorreo">Confirmar correo en Gmail</button>

      <label>Contrase√±a</label>
      <input type="password" id="contrasena" placeholder="********">

      <label>Nombre</label>
      <input type="text" id="nombre">

      <label>Apellido</label>
      <input type="text" id="apellido">

      <label>Documento</label>
      <input type="text" id="documento">

      <label for="tipoDocumento">Tipo de documento</label>
        <select id="tipoDocumento" required>
            <option value="" disabled selected>Seleccione...</option>
            <option value="CC">C√©dula de Ciudadan√≠a (C.C.)</option>
            <option value="TI">Tarjeta de Identidad (T.I.)</option>
            <option value="CE">C√©dula de Extranjer√≠a (C.E.)</option>
            <option value="PA">Pasaporte</option>
            <option value="PEP">Permiso Especial de Permanencia (PEP)</option>
        </select>


      <label>Direcci√≥n</label>
      <input type="text" id="direccion" placeholder="Ejemplo: Calle 10 #25-36, Cartago, Valle del cauca">

      <label>Celular</label>
      <input type="text" id="celular">

      <button type="submit">Guardar cambios</button>
    </form>
  </div>
</div>

<script src="/js/enviar-confirmacion.js"></script>
<script src="/js/sesion.js"></script>
</body>
</html>
